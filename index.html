<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="no-js">
	<head> 
		<title>Kutatás</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="language" content="HU">

		<!-- Meta -->
		<meta http-equiv="refresh" content="300">

		<!-- FavIcon -->
		<!--link href="/public/favicon/favicon.ico" type="image/x-icon" rel="icon"/-->

		<!-- CSS -->
		<!--link href="/public/css/style.css" rel="stylesheet" type="text/css" /-->

		<!-- jQuery -->
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
		<script type="text/javascript" src="public/js/jquery.cookie.js"></script>
		<script type="text/javascript" src="public/js/modernizr-latest.js"></script>
		<!--script type="text/javascript" src="public/js/jqbrowser-uncompressed.js"></script-->
		<script type="text/javascript" src="public/js/PluginDetect_All.js"></script>
		<script type="text/javascript" src="public/js/swfobject.js"></script>
		<!--script type="text/javascript" src="public/js/flash_detect_min.js"></script-->

		<!-- CSS -->
		<style>
			.description {
				border: 1px solid #444444;
				background-color: #BBBBBB;
				padding: 5px;
			}
		</style>

		<!-- JS -->
		<script>
		var fbAppId = "224552787576460";
		var allFontsArray = '';
		var data = "", userId, oldUserId;
		
		$(document).ready(function() {
			<!-- LocalStorage, cookie -->
			if (Modernizr.localstorage) {
				if (localStorage.getItem('userId') != undefined) {
					oldUserId = userId = localStorage.getItem('userId');
					data = "userId="+userId+"&hasFbId=1&";
				}
			} else {
				if ($.cookie("userId") != undefined) {
					oldUserId = userId = $.cookie('userId');
					data = "userId="+userId+"&hasFbId=1&";
				}
			}
			
			<!-- Facebook -->
			/*FB.init({ 
				appId: fbAppId,
				cookie:true, 
				status:true,
				xfbml:true 
			});

			if (typeof(userId) == "undefined") {
				FB.getLoginStatus(function(response) {
					if (response.session) {
						parseUserId(response.session.uid, false);
					}
				});
			}

			$("#fbLine a").click(function() {
				FB.getLoginStatus(function(response) {
					data = "";

					if (response.session) {
						parseUserId(response.session.uid, true);
					} else {
						FB.login(function(response) {
							if (response.session) {
								parseUserId(response.session.uid, true);
							}
						});
					}
				});
			});

			function parseUserId(_userId, _executeCallback) {
				oldUserId = userId;
				userId = _userId;

				$.cookie("userId", _userId);
				localStorage.setItem('userId', _userId);

				FB.api('/'+_userId, function(response) {
					//console.log("First name: "+response.first_name+" Last name: "+response.last_name+" Gender: "+response.gender);

					data = "facebookId="+_userId+"&";
					data += "fbFirstName="+response.first_name+"&";
					data += "fbLastName="+response.last_name+"&";
					data += "fbGender="+response.gender+"&";

					if (_executeCallback) {
						updateData("fb");
					}
				});
			}*/

			<!-- Resolution -->
			data += "screenWidth="+screen.width+"&";
			data += "screenHeight="+screen.height+"&";

			<!-- OS, browser -->
			var os = PluginDetect.OS, OS = "";
			switch (os) {
				case 1:
					OS = "Windows";
					break;
				case 2:
					OS = "Macintosh";
					break;
				case 3:
					OS = "Linux";
					break;
				case 21.1:
					OS = "iPhone";
					break;
				case 21.2:
					OS = "iPod";
					break;
				case 21.3:
					OS = "iPad";
					break;
				default:
					OS = "Other";
			}

			var browser, version;

			if (PluginDetect.isIE) {
				browser = "Internet Explorer";
				version = PluginDetect.verIE;
			}

			if (PluginDetect.isGecko) {
				browser = "Gecko";
				version = PluginDetect.verGecko;
			}

			if (PluginDetect.isSafari) {
				browser = "Safari";
				version = PluginDetect.verSafari;
			}

			if (PluginDetect.isChrome) {
				browser = "Chrome";
				version = PluginDetect.verChrome;
			}

			if (PluginDetect.isOpera) {
				browser = "Opera";
				version = PluginDetect.verOpera;
			}

			data += "browser="+browser+"&";
			data += "browserVersion="+version+"&";
			data += "os="+OS+"&";

			<!-- Flash, Silverlight -->
			var statusSilverlight = PluginDetect.isMinVersion('Silverlight', '0');
			if (statusSilverlight > 0) {
				data += "Silverlight="+PluginDetect.getVersion('Silverlight')+"&";
			}

			var statusFlash = PluginDetect.isMinVersion('Flash', '0');
			if (statusFlash > 0) {
				data += "Flash="+PluginDetect.getVersion('Flash')+"&";
			}
			// Status
			// -0.2 : Plugin is installed but not enabled
			// -1	: Silverlight is out of date or not installed
			// -2	: ActiveX is disabled

			<!-- Modernizr -->
			data += "applicationCache="+Modernizr.applicationcache+"&";	// Application Management
			data += "history="+Modernizr.history+"&";					// History Management
			data += "audio="+Modernizr.audio+"&";						// HTML5 audio
			data += "video="+Modernizr.video+"&";						// HTML5 video
			data += "indexedDB="+Modernizr.indexeddb+"&";				// IndexedDB
			data += "localStorage="+Modernizr.localstorage+"&";			// localStorage
			data += "sessionStorage="+Modernizr.sessionstorage+"&";		// sessionStorage
			data += "webSockets="+Modernizr.websockets+"&";				// webSockets
			data += "webSQLDatabase="+Modernizr.websqldatabase+"&";		// webSQLDatabase
			data += "webWorkers="+Modernizr.webworkers+"&";				// webWorkers
			data += "geoLocation="+Modernizr.geolocation+"&";			// geoLocation
			data += "touch="+Modernizr.touch+"&";						// touch
			data += "webGL="+Modernizr.webgl+"&";						// WebGL
			var connection = navigator.connection || {'type':'0'}; 
			data += "connectionType="+connection.type+"&";// Connection type

			<!-- Referrer -->
			data += "referrer="+document.referrer+"&";

			<!-- GeoLocation -->
			$.getJSON(
				'http://api.ipinfodb.com/v3/ip-city/?key=178043c468512dd9488a9b8e5c7d92528742bdbf6aa48df35fe57140007e35c4&format=json&callback=?',
				function(position) {
					data += "positionLatitude="+position.latitude+"&";
					data += "positionLongitude="+position.longitude+"&";

					// Embedding FontList Flash
					embedFontSWF();
				}
			);

			$("#geoButton").click(function() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition( 
						function (position) {
							// address.city, address.country, address.countryCode, address.postalCode, address.street, address.streetNumber
							data = "positionLatitude="+position.coords.latitude+"&";
							data += "positionLongitude="+position.coords.longitude+"&";

							updateData("geo");
						}
					);
				}
			});

			// Embed FontList SWF
			function embedFontSWF() {
				if (statusFlash > 0) {
					swfobject.embedSWF("public/swf/FontList.swf", "FontListSWF", "1", "1", "9.0.0");
				} else {
					sendData();
				}				
			}

			// ajax
			function updateData(type) {
				$.ajax({
					type: "POST",
					url: "index.php?do="+type+"update&userId="+oldUserId,
					data: data
				});

				console.log("Data ("+type+") is updated successfully!");
			}
		});

		function populateFontList(fontArr) {
			for (var key in fontArr) {
				var fontName = fontArr[key];

				allFontsArray += fontName.replace(/^\s\s*/, '').replace(/\s\s*$/, '') +'|';
			}
			data += "fonts="+allFontsArray+"&";
			sendData();
		}

		function sendData() {
			$.ajax({
				type: "POST",
				url: "index.php?do=save",
				data: data,
				success: function(msg) {
					oldUserId = userId = msg;
					localStorage.setItem('userId', msg);
					$.cookie("userId", msg);

					//console.log("Data saved successfully!");
				}
			});
		}
		</script>
	</head> 
	<body>
		<div class="description">
			Tisztelt Látogató,<br/>
			<p>2012.x.x-től 1 hónapig ezen az oldalon a látogatók adatait elmentjük a GKIeNET és egy Corvinusos Phd kutatás keretében. Bizonyos adatokhoz az Ön hozzájárulása szükséges. Az alul látható gombok lenyomásával Ön hozzájárulhat adatai megosztásához. Kérjük járuljon hozzá adatai megosztásával a kutatás sikeréhez. Adatait az intézményi irányelveknek megfelelően tároljuk és harmadik fél számára nem adjuk ki.</p>

			<a href="#" id="fbButton">Facebook adataim megosztása</a> <a href="#" id="geoButton">GeoLokalizációm megosztása</a>
			</ul>
		</div>

		<!--div id="fb-root"></div>
		<script src="https://connect.facebook.net/hu_HU/all.js"></script-->

		<div id="FontListSWF"></div>
	</body>
</html>